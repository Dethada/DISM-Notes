# Message Authentication Code (MAC)

MAC is effectively a cryptographic checksum of the message. Provides message authentication by validating the sender and assurance that message is unaltered.

Generated by an algorithm that creates a small fixed-sized block appended to the message as a signature.

Receiver performs same computations on the message and checks if it matches the MAC.

## Requirements
- Variable input size
- Fixed output length
- Uses a key
- Efficient (Fast)
- Collision Resistant

## MAC Application

### MAC with message encryption
- For secrecy with authtentication
- Preferred processing (from most to least secure)
    - **Encrypt-then-MAC** - Encrypt message then generate MAC from ciphertext+IV
    - **MAC-then-Encrypt** - Generate MAC and encrypt both MAC and message
    - **Encrypt-and-MAC** - Generate MAC and encrypt message only

### MAC without message encryption
- For authentication and data integrity only. Usually separate keys for each communication pair.

## Keyed Hash Function

### Naive approach
KeyedHash = Hash(Key|Message)

Vulnerable to length extension attacks.

## Hash based Message Authentication Code (HMAC)
HMAC = H[(Key ^ opad) || H[(Key ^ ipad) || Message]]

Key needs to be padded to the block size.

opad = 92, ipad = 54

### Security
Security of HMAC relates to that of the underlying hash algorithm. (MD5 is considerd safe when used with HMAC).

Attacking HMAC requires either
- Brute force attack on the key used
- Birthday attack

## Symmetric Ciphers for MAC
Can use any block cipher chaining mode and use final block as a MAC.

**Data Authentication Algorithm (DAA)** is former US govern standard widely used for producing MAC codes
- using IV=0 and zero-pad of final block
- encrypt message using DES in CBC mode
- send just the final block as the MAC
- or the leftmost M bits (16<=M<=64) of the final block

However final MAC output of DDA 64bit checksum is now too small for security.